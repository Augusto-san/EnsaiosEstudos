<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>WebApp de Revisões</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Link para o CSS -->
  <link rel="stylesheet" href="css/styles.css">

</head>

<body>
  <div class="header">
    <h2>Filtros</h2>
    <select id="disciplina-filter">
      <option value="todos">Todos</option>
    </select>
    <select id="conteudo-filter">
      <option value="todos">Todos</option>
    </select>
  </div>

  <div class="content">
    <div class="flashcard" id="flashcard">
      <div class="front" id="front-content"></div>
      <hr>
      <div class="back" id="back-content"></div>
    </div>
  </div>

  <div class="footer">
    <div class="buttons-container">
      <button id="mostrar-btn">MOSTRAR</button>
      <button id="ocultar-btn">OCULTAR</button>
    </div>
    <div class="navigation-buttons">
      <button id="anterior-btn">ANTERIOR</button>
      <button id="proximo-btn">PRÓXIMO</button>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      let flashcards = [];
      let flashcardsFiltrados = [];
      let indiceAtual = 0;
      const disciplinasMapeadas = new Map();
      const scriptUrl = 'https://script.google.com/macros/s/AKfycby3HKvbEcQBc-UENPrm4L_3BXGomvlsYNWAl7bpWzIN9Vc1a7RdxUiZutiGF2RRCHqAOg/exec';

      function fetchFlashcards() {
        fetch(scriptUrl)
          .then(response => response.json())
          .then(data => {
            flashcards = data;
            flashcardsFiltrados = [...flashcards];
            preencherFiltros();
            atualizarFlashcard();
          })
          .catch(error => console.error('Erro ao buscar dados:', error));
      }

      function preencherFiltros() {
        const disciplinas = new Set();

        flashcards.forEach(card => {
          if (!disciplinasMapeadas.has(card.disciplina)) {
            disciplinasMapeadas.set(card.disciplina, new Set());
          }
          disciplinas.add(card.disciplina);
          disciplinasMapeadas.get(card.disciplina).add(card.conteudo);
        });

        const disciplinaFilter = document.getElementById('disciplina-filter');
        disciplinas.forEach(d => {
          const option = document.createElement('option');
          option.value = d;
          option.textContent = d;
          disciplinaFilter.appendChild(option);
        });

        atualizarConteudos(); // Atualizar os conteúdos para a disciplina inicial
      }

      function atualizarConteudos() {
        const disciplinaSelecionada = document.getElementById('disciplina-filter').value;
        const conteudoFilter = document.getElementById('conteudo-filter');

        conteudoFilter.innerHTML = '<option value="todos">Todos</option>';

        if (disciplinasMapeadas.has(disciplinaSelecionada)) {
          disciplinasMapeadas.get(disciplinaSelecionada).forEach(conteudo => {
            const option = document.createElement('option');
            option.value = conteudo;
            option.textContent = conteudo;
            conteudoFilter.appendChild(option);
          });
        }
      }

      function aplicarFiltros() {
        const disciplinaSelecionada = document.getElementById('disciplina-filter').value;
        const conteudoSelecionado = document.getElementById('conteudo-filter').value;

        flashcardsFiltrados = flashcards.filter(card => {
          const disciplinaMatch = disciplinaSelecionada === 'todos' || card.disciplina === disciplinaSelecionada;
          const conteudoMatch = conteudoSelecionado === 'todos' || card.conteudo === conteudoSelecionado;
          return disciplinaMatch && conteudoMatch;
        });

        indiceAtual = 0;
        atualizarFlashcard();
      }

      function atualizarFlashcard() {
        if (flashcardsFiltrados.length === 0) {
          alert("Nenhum flashcard encontrado.");
          return;
        }
        document.getElementById('front-content').innerHTML = flashcardsFiltrados[indiceAtual].frente;
        document.getElementById('back-content').innerHTML = flashcardsFiltrados[indiceAtual].tras;
        document.getElementById('back-content').style.display = 'none';
      }

      document.getElementById('disciplina-filter').addEventListener('change', () => {
        atualizarConteudos();
        aplicarFiltros();
      });

      document.getElementById('conteudo-filter').addEventListener('change', aplicarFiltros);

      fetchFlashcards();
    });
  </script>
</body>

</html>
